<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Distill — YouTube Summariser</title>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #f5f5f7;
    --surface: rgba(255,255,255,0.72);
    --surface-solid: #ffffff;
    --border: rgba(0,0,0,0.08);
    --text: #1d1d1f;
    --text-secondary: #6e6e73;
    --accent: #0071e3;
    --accent-hover: #0077ed;
    --red: #ff3b30;
    --success: #34c759;
    --radius: 18px;
    --radius-sm: 12px;
    --shadow: 0 4px 24px rgba(0,0,0,0.07), 0 1px 4px rgba(0,0,0,0.05);
    --shadow-lg: 0 12px 48px rgba(0,0,0,0.12), 0 2px 8px rgba(0,0,0,0.06);
  }

  @media (prefers-color-scheme: dark) {
    :root {
      --bg: #000000;
      --surface: rgba(28,28,30,0.85);
      --surface-solid: #1c1c1e;
      --border: rgba(255,255,255,0.1);
      --text: #f5f5f7;
      --text-secondary: #98989d;
      --shadow: 0 4px 24px rgba(0,0,0,0.4), 0 1px 4px rgba(0,0,0,0.3);
      --shadow-lg: 0 12px 48px rgba(0,0,0,0.5), 0 2px 8px rgba(0,0,0,0.4);
    }
  }

  html, body {
    min-height: 100%;
    font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    -webkit-font-smoothing: antialiased;
  }

  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 64px 20px 60px;
    min-height: 100vh;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      radial-gradient(ellipse 80% 50% at 20% -10%, rgba(0,122,255,0.06) 0%, transparent 60%),
      radial-gradient(ellipse 60% 40% at 80% 110%, rgba(52,199,89,0.04) 0%, transparent 60%);
    pointer-events: none;
    z-index: 0;
  }

  .container {
    position: relative;
    z-index: 1;
    width: 100%;
    max-width: 680px;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .header {
    text-align: center;
    margin-bottom: 8px;
    animation: fadeUp 0.6s ease both;
  }

  .logo {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 18px;
  }

  .logo-icon {
    width: 42px;
    height: 42px;
    background: linear-gradient(145deg, #0071e3, #34aadc);
    border-radius: 11px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 16px rgba(0,113,227,0.35);
  }

  .logo-icon svg { width: 20px; height: 20px; }

  .logo-text {
    font-size: 21px;
    font-weight: 600;
    letter-spacing: -0.5px;
  }

  h1 {
    font-size: clamp(30px, 5vw, 46px);
    font-weight: 600;
    letter-spacing: -1.5px;
    line-height: 1.08;
    margin-bottom: 10px;
  }

  .subtitle {
    font-size: 17px;
    color: var(--text-secondary);
    font-weight: 400;
    letter-spacing: -0.2px;
  }

  .card {
    background: var(--surface);
    backdrop-filter: blur(20px) saturate(1.8);
    -webkit-backdrop-filter: blur(20px) saturate(1.8);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 24px;
    box-shadow: var(--shadow);
    animation: fadeUp 0.6s ease 0.1s both;
  }

  .api-section { animation: fadeUp 0.6s ease 0.05s both; }

  .api-label {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
  }

  .api-label-text {
    font-size: 13px;
    font-weight: 500;
    color: var(--text-secondary);
  }

  .api-label-link {
    font-size: 12px;
    color: var(--accent);
    text-decoration: none;
  }
  .api-label-link:hover { text-decoration: underline; }

  .api-input-row {
    display: flex;
    gap: 10px;
    align-items: center;
  }

  .key-input-wrap {
    position: relative;
    flex: 1;
  }

  .key-input-wrap svg {
    position: absolute;
    left: 13px;
    top: 50%;
    transform: translateY(-50%);
    width: 15px;
    height: 15px;
    opacity: 0.4;
    pointer-events: none;
  }

  .text-input {
    width: 100%;
    height: 48px;
    padding: 0 14px;
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    background: var(--surface-solid);
    color: var(--text);
    font-size: 14px;
    font-family: inherit;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  .text-input.padded-left { padding-left: 36px; }
  .text-input::placeholder { color: var(--text-secondary); opacity: 0.6; }
  .text-input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(0,113,227,0.13);
  }
  .text-input.mono {
    font-family: 'SF Mono', 'Menlo', 'Monaco', monospace;
    font-size: 13px;
  }

  .btn-save {
    height: 48px;
    padding: 0 18px;
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    background: transparent;
    color: var(--accent);
    font-size: 13px;
    font-weight: 500;
    font-family: inherit;
    cursor: pointer;
    white-space: nowrap;
    transition: background 0.15s, border-color 0.15s;
    flex-shrink: 0;
  }
  .btn-save:hover { background: rgba(0,113,227,0.06); border-color: rgba(0,113,227,0.3); }

  .key-status {
    margin-top: 8px;
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 5px;
    color: var(--text-secondary);
    min-height: 18px;
  }
  .key-status.saved { color: var(--success); }
  .key-status.error { color: var(--red); }

  .status-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: currentColor;
    flex-shrink: 0;
  }

  .input-group {
    display: flex;
    gap: 10px;
    align-items: center;
  }

  .url-input-wrap {
    position: relative;
    flex: 1;
  }

  .url-input-wrap svg {
    position: absolute;
    left: 13px;
    top: 50%;
    transform: translateY(-50%);
    width: 15px;
    height: 15px;
    opacity: 0.35;
    pointer-events: none;
  }

  .btn-primary {
    height: 48px;
    padding: 0 20px;
    border: none;
    border-radius: var(--radius-sm);
    background: var(--accent);
    color: white;
    font-size: 15px;
    font-weight: 500;
    font-family: inherit;
    cursor: pointer;
    white-space: nowrap;
    transition: background 0.15s, transform 0.1s, box-shadow 0.15s;
    letter-spacing: -0.2px;
    display: flex;
    align-items: center;
    gap: 7px;
    flex-shrink: 0;
  }
  .btn-primary svg { width: 15px; height: 15px; flex-shrink: 0; }
  .btn-primary:hover:not(:disabled) { background: var(--accent-hover); box-shadow: 0 4px 16px rgba(0,113,227,0.35); }
  .btn-primary:active:not(:disabled) { transform: scale(0.97); }
  .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }

  .error-msg {
    margin-top: 11px;
    padding: 11px 14px;
    background: rgba(255,59,48,0.08);
    border: 1px solid rgba(255,59,48,0.18);
    border-radius: 10px;
    color: var(--red);
    font-size: 13.5px;
    line-height: 1.5;
    display: none;
  }
  .error-msg.visible { display: block; }

  .loading-state {
    display: none;
    align-items: center;
    gap: 12px;
    padding: 20px 4px 6px;
  }
  .loading-state > div { display: flex; flex-direction: column; }
  .loading-state.visible { display: flex; }

  .spinner {
    width: 20px;
    height: 20px;
    border: 2px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.75s linear infinite;
    flex-shrink: 0;
  }

  .loading-label { font-size: 13.5px; color: var(--text-secondary); }

  .loading-timer {
    display: block;
    font-size: 12px;
    color: var(--text-secondary);
    opacity: 0.55;
    font-variant-numeric: tabular-nums;
    margin-top: 2px;
  }

  .results-card {
    background: var(--surface);
    backdrop-filter: blur(20px) saturate(1.8);
    -webkit-backdrop-filter: blur(20px) saturate(1.8);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
    box-shadow: var(--shadow-lg);
    display: none;
  }
  .results-card.visible {
    display: block;
    animation: fadeUp 0.45s ease both;
  }

  .results-header {
    padding: 18px 22px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 14px;
  }

  .video-thumbnail {
    width: 88px;
    height: 56px;
    border-radius: 8px;
    object-fit: cover;
    background: var(--border);
    flex-shrink: 0;
  }

  .video-meta { flex: 1; min-width: 0; }

  .video-title {
    font-size: 13.5px;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-bottom: 4px;
    letter-spacing: -0.1px;
  }

  .video-badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    font-size: 11.5px;
    color: var(--success);
    font-weight: 500;
  }

  .badge-dot {
    width: 5px;
    height: 5px;
    border-radius: 50%;
    background: var(--success);
  }

  .bullets-list { padding: 4px 0; }

  .bullet-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 13px 22px;
    border-bottom: 1px solid var(--border);
    animation: fadeRight 0.4s ease both;
  }
  .bullet-item:last-child { border-bottom: none; }

  .bullet-num {
    flex-shrink: 0;
    width: 21px;
    height: 21px;
    background: rgba(0,113,227,0.1);
    color: var(--accent);
    border-radius: 50%;
    font-size: 10.5px;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 2px;
  }

  .bullet-text {
    font-size: 14.5px;
    line-height: 1.55;
    letter-spacing: -0.15px;
  }

  .results-footer {
    padding: 13px 22px;
    border-top: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .footer-note { font-size: 12px; color: var(--text-secondary); }

  .btn-copy {
    height: 32px;
    padding: 0 14px;
    border: 1.5px solid var(--border);
    border-radius: 9px;
    background: transparent;
    color: var(--accent);
    font-size: 13px;
    font-weight: 500;
    font-family: inherit;
    cursor: pointer;
    transition: background 0.15s;
  }
  .btn-copy:hover { background: rgba(0,113,227,0.06); }

  .privacy-note {
    text-align: center;
    font-size: 12px;
    color: var(--text-secondary);
    opacity: 0.75;
    animation: fadeUp 0.6s ease 0.2s both;
    line-height: 1.6;
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(14px); }
    to   { opacity: 1; transform: translateY(0); }
  }
  @keyframes fadeRight {
    from { opacity: 0; transform: translateX(-6px); }
    to   { opacity: 1; transform: translateX(0); }
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* Settings */
  .settings-area {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0;
    animation: fadeUp 0.6s ease 0.2s both;
  }

  .settings-toggle {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 7px 14px;
    border: 1px solid var(--border);
    border-radius: 20px;
    background: transparent;
    color: var(--text-secondary);
    font-size: 12px;
    font-family: inherit;
    cursor: pointer;
    transition: background 0.15s, color 0.15s;
  }
  .settings-toggle:hover { background: var(--surface); color: var(--text); }
  .settings-toggle .chevron { transition: transform 0.2s; }
  .settings-toggle.open .chevron { transform: rotate(180deg); }

  .settings-panel {
    display: none;
    width: 100%;
    max-width: 480px;
    margin-top: 12px;
    padding: 18px;
    background: var(--surface);
    backdrop-filter: blur(20px) saturate(1.8);
    -webkit-backdrop-filter: blur(20px) saturate(1.8);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    animation: fadeUp 0.2s ease both;
  }
  .settings-panel.open { display: block; }

  .settings-note {
    margin-top: 10px;
    font-size: 11.5px;
    color: var(--text-secondary);
    opacity: 0.7;
  }
  .settings-note a { color: var(--accent); text-decoration: none; }
  .settings-note a:hover { text-decoration: underline; }
</style>
</head>
<body>
<div class="container">

  <div class="header">
    <div class="logo">
      <div class="logo-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
      </div>
      <span class="logo-text">Distill</span>
    </div>
    <h1>The essence of<br>any YouTube video.</h1>
    <p class="subtitle">Paste a link. Get the key points in seconds.</p>
  </div>



  <!-- URL Card -->
  <div class="card">
    <div class="input-group">
      <div class="url-input-wrap">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M22.54 6.42a2.78 2.78 0 00-1.94-1.96C18.88 4 12 4 12 4s-6.88 0-8.6.46A2.78 2.78 0 001.46 6.42 29 29 0 001 12a29 29 0 00.46 5.58 2.78 2.78 0 001.94 1.96C5.12 20 12 20 12 20s6.88 0 8.6-.46a2.78 2.78 0 001.94-1.96A29 29 0 0023 12a29 29 0 00-.46-5.58z"/>
          <polygon points="9.75 15.02 15.5 12 9.75 8.98 9.75 15.02" fill="currentColor" stroke="none"/>
        </svg>
        <input
          class="text-input padded-left"
          id="urlInput"
          type="url"
          placeholder="https://youtube.com/watch?v=..."
          autocomplete="off"
          spellcheck="false"
        />
      </div>
      <button class="btn-primary" id="summariseBtn" onclick="handleSummarise()">
        <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
        </svg>
        Summarise
      </button>
    </div>
    <div class="error-msg" id="errorMsg"></div>
    <div class="loading-state" id="loadingState">
      <div class="spinner"></div>
      <div>
        <span class="loading-label" id="loadingLabel">Analysing video with Gemini…</span>
        <span class="loading-timer" id="loadingTimer"></span>
      </div>
    </div>
  </div>

  <!-- Results -->
  <div class="results-card" id="resultsCard">
    <div class="results-header">
      <img class="video-thumbnail" id="videoThumb" src="" alt="Video thumbnail" />
      <div class="video-meta">
        <div class="video-title" id="videoTitle">—</div>
        <div class="video-badge"><span class="badge-dot"></span> Summary ready</div>
      </div>
    </div>
    <div class="bullets-list" id="bulletsList"></div>
    <div class="results-footer">
      <span class="footer-note" id="bulletCount"></span>
      <button class="btn-copy" onclick="copyResults()">Copy summary</button>
    </div>
  </div>

  <div class="settings-area">
    <button class="settings-toggle" onclick="toggleSettings()" id="settingsToggle">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="13" height="13">
        <circle cx="12" cy="12" r="3"/><path d="M19.07 4.93a10 10 0 010 14.14M4.93 4.93a10 10 0 000 14.14"/>
      </svg>
      API Key
      <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" width="11" height="11">
        <polyline points="6 9 12 15 18 9"/>
      </svg>
    </button>
    <div class="settings-panel" id="settingsPanel">
      <div class="api-input-row">
        <div class="key-input-wrap">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0110 0v4"/>
          </svg>
          <input
            class="text-input mono padded-left"
            id="apiKeyInput"
            type="password"
            placeholder="AIza..."
            autocomplete="off"
            spellcheck="false"
          />
        </div>
        <button class="btn-save" onclick="saveKey()">Save</button>
      </div>
      <div class="key-status" id="keyStatus"></div>
      <p class="settings-note">Your key is stored only in this browser. <a href="https://aistudio.google.com/apikey" target="_blank" rel="noopener">Get a key →</a></p>
    </div>
  </div>

</div>

<script>
const KEY_STORAGE = 'distill_gemini_key';

function saveKey() {
  const val = document.getElementById('apiKeyInput').value.trim();
  if (!val) { setKeyStatus('error', 'Please paste your Gemini API key first.'); return; }
  if (!val.startsWith('AIza')) { setKeyStatus('error', "That doesn't look like a Gemini key (should start with AIza)."); return; }
  localStorage.setItem(KEY_STORAGE, val);
  setKeyStatus('saved', 'Key saved in your browser.');
}

function getKey() {
  return localStorage.getItem(KEY_STORAGE) || document.getElementById('apiKeyInput').value.trim();
}

function setKeyStatus(type, msg) {
  const el = document.getElementById('keyStatus');
  el.className = 'key-status ' + type;
  el.innerHTML = msg ? `<span class="status-dot"></span>${msg}` : '';
}

window.addEventListener('DOMContentLoaded', () => {
  const saved = localStorage.getItem(KEY_STORAGE);
  if (saved) {
    document.getElementById('apiKeyInput').value = saved;
    setKeyStatus('saved', 'Key loaded from your browser.');
  } else {
    // No key yet — open settings automatically so they know what to do
    toggleSettings();
  }
  document.getElementById('urlInput').addEventListener('keydown', e => { if (e.key === 'Enter') handleSummarise(); });
  document.getElementById('apiKeyInput').addEventListener('keydown', e => { if (e.key === 'Enter') saveKey(); });
});

function extractVideoId(url) {
  try {
    const u = new URL(url.trim());
    if (u.hostname.includes('youtu.be')) return u.pathname.slice(1).split('?')[0];
    if (u.hostname.includes('youtube')) {
      const v = u.searchParams.get('v');
      if (v) return v;
      const m = u.pathname.match(/(?:embed|v|shorts)\/([^/?]+)/);
      if (m) return m[1];
    }
  } catch {}
  const m = url.match(/(?:v=|youtu\.be\/|embed\/|shorts\/)([A-Za-z0-9_-]{11})/);
  return m ? m[1] : null;
}

function showError(msg) {
  const el = document.getElementById('errorMsg');
  el.textContent = msg;
  el.classList.add('visible');
}

function clearError() { document.getElementById('errorMsg').classList.remove('visible'); }

let timerInterval = null;

function setLoading(on, label = 'Analysing video with Gemini…') {
  document.getElementById('loadingState').classList.toggle('visible', on);
  document.getElementById('loadingLabel').textContent = label;
  document.getElementById('summariseBtn').disabled = on;

  if (on) {
    const start = Date.now();
    const timerEl = document.getElementById('loadingTimer');
    timerEl.textContent = '0s';
    timerInterval = setInterval(() => {
      const secs = Math.floor((Date.now() - start) / 1000);
      timerEl.textContent = secs + 's';
    }, 1000);
  } else {
    clearInterval(timerInterval);
    document.getElementById('loadingTimer').textContent = '';
  }
}

async function getVideoTitle(videoId) {
  try {
    const res = await fetch(`https://noembed.com/embed?url=https://www.youtube.com/watch?v=${videoId}`);
    const data = await res.json();
    return data.title || 'YouTube Video';
  } catch { return 'YouTube Video'; }
}

async function summariseWithGemini(videoId, apiKey) {
  const youtubeUrl = `https://www.youtube.com/watch?v=${videoId}`;
  const prompt = `Watch this YouTube video and extract the 5–10 most important bullet points.

Each bullet point should:
- Be a complete, informative sentence (not a vague headline)
- Capture a specific insight, fact, argument, or key takeaway
- Be written clearly so someone who hasn't watched it can understand it

Respond ONLY with a JSON array of strings. No preamble, no markdown fences, just the raw JSON.
Example: ["First key point.", "Second key point.", "Third key point."]`;

  const res = await fetch(
    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`,
    {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        contents: [{
          parts: [
            { file_data: { file_uri: youtubeUrl, mime_type: "video/mp4" } },
            { text: prompt }
          ]
        }],
        generationConfig: { temperature: 0.3, maxOutputTokens: 1024 }
      })
    }
  );

  const data = await res.json();

  if (!res.ok) {
    const msg = (data.error?.message || '').toLowerCase();
    if (res.status === 400 && msg.includes('api key')) throw new Error('invalid_key');
    if (res.status === 403) throw new Error('invalid_key');
    if (msg.includes('not supported') || msg.includes('unable to process') || msg.includes('invalid')) throw new Error('video_unsupported');
    throw new Error(data.error?.message || 'api_error');
  }

  const raw = data.candidates?.[0]?.content?.parts?.[0]?.text || '';
  if (!raw) throw new Error('empty_response');
  const parsed = JSON.parse(raw.replace(/```json|```/g, '').trim());
  if (!Array.isArray(parsed) || parsed.length === 0) throw new Error('empty_response');
  return parsed;
}

function renderResults(videoId, title, bullets) {
  document.getElementById('videoThumb').src = `https://img.youtube.com/vi/${videoId}/mqdefault.jpg`;
  document.getElementById('videoTitle').textContent = title;
  const list = document.getElementById('bulletsList');
  list.innerHTML = '';
  bullets.forEach((text, i) => {
    const item = document.createElement('div');
    item.className = 'bullet-item';
    item.style.animationDelay = `${i * 0.055}s`;
    item.innerHTML = `<div class="bullet-num">${i + 1}</div><div class="bullet-text">${text}</div>`;
    list.appendChild(item);
  });
  document.getElementById('bulletCount').textContent = `${bullets.length} key points`;
  const card = document.getElementById('resultsCard');
  card.classList.add('visible');
  setTimeout(() => card.scrollIntoView({ behavior: 'smooth', block: 'nearest' }), 100);
}

function copyResults() {
  const title = document.getElementById('videoTitle').textContent;
  const points = [...document.querySelectorAll('.bullet-text')].map((el, i) => `${i + 1}. ${el.textContent}`).join('\n');
  navigator.clipboard.writeText(`${title}\n\n${points}`).then(() => {
    const btn = document.querySelector('.btn-copy');
    btn.textContent = 'Copied!';
    setTimeout(() => btn.textContent = 'Copy summary', 1800);
  });
}

async function handleSummarise() {
  clearError();
  document.getElementById('resultsCard').classList.remove('visible');

  const url = document.getElementById('urlInput').value.trim();
  const apiKey = getKey();

  if (!apiKey || !apiKey.startsWith('AIza')) {
    showError('Please enter and save your Gemini API key first. Get one free at aistudio.google.com/apikey');
    return;
  }
  if (!url) { showError('Please paste a YouTube video URL.'); return; }

  const videoId = extractVideoId(url);
  if (!videoId) {
    showError("That doesn't look like a valid YouTube URL. Try copying it directly from your browser's address bar.");
    return;
  }

  setLoading(true);
  const title = await getVideoTitle(videoId);

  try {
    const bullets = await summariseWithGemini(videoId, apiKey);
    setLoading(false);
    renderResults(videoId, title, bullets);
  } catch (e) {
    setLoading(false);
    if (e.message === 'invalid_key') {
      showError('Your API key was rejected. Double-check it at aistudio.google.com/apikey and save it again.');
    } else if (e.message === 'video_unsupported') {
      showError("Gemini couldn't access this video — it may be private, age-restricted, or region-blocked.");
    } else {
      showError(`Something went wrong: ${e.message}. Please try again.`);
    }
  }
}

function toggleSettings() {
  const btn = document.getElementById('settingsToggle');
  const panel = document.getElementById('settingsPanel');
  const isOpen = panel.classList.contains('open');
  btn.classList.toggle('open', !isOpen);
  panel.classList.toggle('open', !isOpen);
}
</script>
</body>
</html>
